# Raman-Monte-Carlo
A program built atop the MCX infrastructure that uses a custom launch function “isoweight”, referenced as “weighed” in the code to simulate Raman scattering effectively. A note of caution, this algorithm samples the excitation source based on a random number generator, so there is no guarantee that every excitation pixel is hit. Rather, the function serves as a statistical sampler which helps to preserve time and efficiency, which also helps greatly in sampling larger volumes, where brute-forcing from every volume pixel would take an abhorrently large amount of time.  

The “isoweight/weighed” function is a new launch function implemented in MCX that takes the excitation matrix flux/fluence, rasterizes the values, cumulatively sums and normalizes to 1, and then uses a random number generation to query this line.
An exert from the published report gives a better understanding of the details:
“In the second step, the subsequent photon emission process is implemented as a 3D volumetric light source, accelerated by using an inverse distribution method (IDM) based on the excitation fluence map. Specifically, a normalized excitation fluence distribution, obtained from the above step (Figure 2a), can be interpreted as the probability density function (PDF) of photons within the 3D domain. This 3D PDF is then serialized into a 1D vector, with each value representing a normalized fluence value in a given voxel. We also store the corresponding voxel index (as a 1D linear index) alongside with the 1D PDF. From this 1D PDF, we can compute the cumulative density function, or CDF, by numerically integrating the PDF. The normalized cumulative flux vs. volume index is then inverted, to create a mapping (Figure 2c) between a uniform 0-1 distributed random variable to the linear index of the voxel from which to launch the new emission photon. This procedure is implemented in MCX as a left-side binary search. The binary search algorithm is known for its speed, and when implemented on the GPU, dramatically increases the computational efficiency of emission photon generation.”

This code is very much based on the open-source MCX project by Qianqian Fang, which can be downloaded at https://sourceforge.net/projects/mcx/. I would like to thank Dr. Qianqian Fang and his team for providing such a great code to build upon, and providing help at every step of the way. 
